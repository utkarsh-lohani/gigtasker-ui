<div class="dashboard-page">
    <!-- Background blobs -->
    <div class="blob blob1"></div>
    <div class="blob blob2"></div>
    <div class="blob blob3"></div>

    <div class="dashboard-container glass-card">
        <!-- USER CARD -->
        <mat-card class="glass-panel dashboard-card user-card">
            <mat-card-header>
                <mat-card-title>
                    @if (user()) { Welcome, {{ user()?.firstName }}! } @else {
                    <div class="card-loader">
                        <mat-spinner diameter="40"></mat-spinner>
                    </div>
                    }
                </mat-card-title>

                @if (user()) {
                <mat-card-subtitle>
                    {{ user()?.firstName }} {{ user()?.lastName }} ({{ user()?.email }})
                </mat-card-subtitle>
                }
            </mat-card-header>

            <mat-card-content>
                <p>Your dashboard overview. Manage gigs, bids and messages.</p>
            </mat-card-content>
        </mat-card>

        <!-- CREATE GIG -->
        <mat-card class="glass-panel dashboard-card create-task-card">
            <mat-card-header>
                <mat-card-title>Post a New Gig</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <app-create-task-component
                    [currentUser]="user()"
                    (taskCreated)="refreshTaskLists()"
                ></app-create-task-component>
            </mat-card-content>
        </mat-card>

        <!-- TABS -->
        <mat-tab-group
            class="glass-panel dashboard-tabs"
            animationDuration="400ms"
            (selectedTabChange)="selectedTabIndex.set($event.index)"
        >
            <mat-tab label="All Gigs">
                @if (selectedTabIndex() === 0) {
                <app-task-list [tasks]="allTasks()" [isLoading]="allTasksLoading()"></app-task-list>
                }
            </mat-tab>

            <mat-tab label="My Posted Gigs">
                @if (selectedTabIndex() === 1 && user()) {
                <app-task-list [tasks]="myTasks()" [isLoading]="myTasksLoading()"></app-task-list>
                }
            </mat-tab>

            <mat-tab label="My Bids">
                @if (selectedTabIndex() === 2 && user()) {
                <app-my-bids [bids]="myBids()" [isLoading]="myBidsLoading()"></app-my-bids>
                }
            </mat-tab>

            <mat-tab>
                <ng-template mat-tab-label>
                    <mat-icon class="tab-icon">account_balance_wallet</mat-icon>
                    My Wallet
                </ng-template>

                @if (selectedTabIndex() === 3) {
                <app-wallet-component></app-wallet-component>
                }
            </mat-tab>

            <mat-tab>
                <ng-template mat-tab-label>
                    <mat-icon class="tab-icon">chat</mat-icon>
                    Messages
                </ng-template>

                @if (selectedTabIndex() === 4) {
                <app-chat-component></app-chat-component>
                }
            </mat-tab>
        </mat-tab-group>
    </div>
</div>
